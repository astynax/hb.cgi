# Local Variables:
# org-confirm-babel-evaluate: nil
# End:

* /setup/
#+NAME: input
#+BEGIN_example yaml
counters:
 - value: 0
 - value: 5
 - value: 10
#+END_example

#+NAME: json
#+BEGIN_SRC shell :var input=input :results raw :wrap example
echo "$input" | rq -yJ
#+END_SRC

* actions
:PROPERTIES:
:header-args:shell: :var input=json :results raw :wrap example
:END:

** appending

#+BEGIN_SRC shell
echo "$input" | jq '.counters += [{"value": 0}]'
#+END_SRC

** changing

#+BEGIN_SRC shell
echo "$input" | jq '.counters.[0].value += 1'
#+END_SRC

** deletion

#+BEGIN_SRC shell
echo "$input" | jq 'del(.counters.[1])'
#+END_SRC

* diagram

#+BEGIN_SRC plantuml
@startuml

skinparam responseMessageBelowArrow true

group First visit
Browser -> Server: GET /counters.cgi
note left: Protocol&host\nare hidden here\njust for the\nsimplicity
Browser <- Server: 307 Redirect Temporarly\nLocation: /hb.cgi\n\t?t=counters.html\n\t&d=/jq.cgi\n\t\t?u={}\n\t\t&q=.
note right: jq.cgi call is\nadditionally\nurlencoded
Browser -> Server: GET /hb.cgi?...
Browser <- Server: HTML
end group

group Interaction
Browser -> Server: GET /counters.cgi\n\t?s={...}\n\t&q=.counters.[0]+=1
note left: Any action\npasses all\nthe state
Browser <- Server: 307 Redirect Temporarly\nLocation: /hb.cgi?...
Browser -> Server: GET /hb.cgi?...
Browser <- Server: HTML
end group

@enduml
#+END_SRC

[[file:counters.png]]
